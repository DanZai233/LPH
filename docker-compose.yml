version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: lph-backend
    ports:
      - "3001:3001"
    environment:
      - PORT=3001
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - CORS_ORIGIN=http://localhost:5173
      - NODE_ENV=production
      - DATABASE_PATH=/app/data/lph.db
    volumes:
      # 挂载数据库文件目录
      - ./backend/data:/app/data
      # 如果需要访问宿主机系统信息，可以挂载相关目录
      # 注意：在生产环境中应该使用更安全的挂载方式
      - /etc/os-release:/etc/os-release:ro
      - /proc:/proc:ro
    restart: unless-stopped
    # 使用特权模式以便访问系统命令（可选）
    privileged: true
    networks:
      - lph-network

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: lph-frontend
    ports:
      - "5173:80"
    environment:
      - VITE_API_URL=http://localhost:3001/api
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - lph-network

networks:
  lph-network:
    driver: bridge

