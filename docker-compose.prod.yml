services:
  backend:
    image: lph-backend:latest
    container_name: lph-backend
    ports:
      - "3888:3888"
    environment:
      - PORT=3888
      - CORS_ORIGIN=http://localhost:3777
      - NODE_ENV=production
      - DATABASE_PATH=/app/data
    volumes:
      # 挂载数据库文件目录
      - ./backend/data:/app/data
      # 挂载系统文件以获取系统信息（只读）
      - /etc/os-release:/etc/os-release:ro
      - /proc:/proc:ro
    restart: unless-stopped
    # 使用特权模式以便访问系统命令
    privileged: true
    # 禁用 AppArmor 以避免 profile 冲突
    security_opt:
      - apparmor=unconfined
      - seccomp=unconfined
    networks:
      - lph-network

  frontend:
    image: lph-frontend:latest
    container_name: lph-frontend
    ports:
      - "3777:80"
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - lph-network

networks:
  lph-network:
    driver: bridge

